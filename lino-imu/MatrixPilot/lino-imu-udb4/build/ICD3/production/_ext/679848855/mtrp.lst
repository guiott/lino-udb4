MPLAB ASM30 Listing:  ../../libVectorMatrix/mtrp.s 			page 1


   1              	;*********************************************************************
   2              	;                                                                    *
   3              	;                       Software License Agreement                   *
   4              	;                                                                    *
   5              	;   The software supplied herewith by Microchip Technology           *
   6              	;   Incorporated (the "Company") for its dsPIC controller            *
   7              	;   is intended and supplied to you, the Company's customer,         *
   8              	;   for use solely and exclusively on Microchip dsPIC                *
   9              	;   products. The software is owned by the Company and/or its        *
  10              	;   supplier, and is protected under applicable copyright laws. All  *
  11              	;   rights are reserved. Any use in violation of the foregoing       *
  12              	;   restrictions may subject the user to criminal sanctions under    *
  13              	;   applicable laws, as well as to civil liability for the breach of *
  14              	;   the terms and conditions of this license.                        *
  15              	;                                                                    *
  16              	;   THIS SOFTWARE IS PROVIDED IN AN "AS IS" CONDITION.  NO           *
  17              	;   WARRANTIES, WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING,    *
  18              	;   BUT NOT LIMITED TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND    *
  19              	;   FITNESS FOR A PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE     *
  20              	;   COMPANY SHALL NOT, IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL,  *
  21              	;   INCIDENTAL OR CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.  *
  22              	;                                                                    *
  23              	;   (c) Copyright 2003 Microchip Technology, All rights reserved.    *
  24              	;*********************************************************************
  25              	
  26              		; Local inclusions.
  28              		.list
  29              	
  30              	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  31              	
  32              		.section .libdsp, code
  33              	
  34              	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  35              	;
  36              	; _MatrixTranspose: Matrix transposition.
  37              	;
  38              	; Operation:
  39              	;	dstM[i][j] = srcM[j][i]
  40              	;
  41              	; Input:
  42              	;	w0 = number rows in source matrix (numRows)
  43              	;	w1 = number cols in source matrix (numCols)
  44              	;	w2 = ptr to destination matrix (dstM)
  45              	;	w3 = ptr to source matrix (srcM)
  46              	; Return:
  47              	;	w0 = ptr to destination matrix (dstM)
  48              	;
  49              	; System resources usage:
  50              	;	{w0..w5}	used, not restored
  51              	;
  52              	; DO and REPEAT instruction usage.
  53              	;	2 level DO instruction
  54              	;	no REPEAT intructions
  55              	;
  56              	; Program words (24-bit instructions):
  57              	;	14
  58              	;
MPLAB ASM30 Listing:  ../../libVectorMatrix/mtrp.s 			page 2


  59              	; Cycles (including C-function call and return overheads):
  60              	;	16 + numCols*(6 + (numRows-1)*3)
  61              	;............................................................................
  62              	
  63              		.global	_MatrixTranspose	; export
  64              	_MatrixTranspose:
  65              	
  66              	;............................................................................
  67              	
  68 000000  82 02 78 		mov	w2,w5				; save return value (dstV)
  69              	
  70              	;............................................................................
  71              	
  72              		; Prepare operation.
  73 000002  00 00 E9 		dec	w0,w0				; w0 = numRows-1
  74 000004  01 02 E9 		dec	w1,w4				; w4 = numCols-1
  75 000006  81 80 40 		add	w1,w1,w1			; w1 = sizeof (Rows)
  76              	
  77              		; Perform operation.
  78              	
  79              	;	save the do loop registers
  80 000008  00 00 F8 		push	DCOUNT
  81 00000a  00 00 F8 		push	DOSTARTL
  82 00000c  00 00 F8 		push	DOSTARTH
  83 00000e  00 00 F8 		push	DOENDL
  84 000010  00 00 F8 		push	DOENDH
  85              	
  86 000012  04 80 08 		do	w4,_endCols		; {	; do (numCols-1)+1 times
  86         00 00 00 
  87 000016  03 02 78 		mov	w3,w4				; w4-> srcM[0][c]
  88              	
  89              	;	save the do loop registers
  90 000018  00 00 F8 		push	DCOUNT
  91 00001a  00 00 F8 		push	DOSTARTL
  92 00001c  00 00 F8 		push	DOSTARTH
  93 00001e  00 00 F8 		push	DOENDL
  94 000020  00 00 F8 		push	DOENDH
  95              	
  96 000022  00 80 08 		do	w0,_endRows		; {	; do (numRows-1)+1 times
  96         00 00 00 
  97 000026  14 19 78 		mov	[w4],[w2++]			; dstM[c][r] = srcM[r][c]
  98              							; w2-> dstM[c][r+1]
  99              	_endRows:
 100 000028  01 02 42 		add	w4,w1,w4			; w4-> srcM[r+1][c]
 101              	
 102              	;	restore the do loop registers
 103 00002a  00 00 F9 		pop		DOENDH
 104 00002c  00 00 F9 		pop		DOENDL
 105 00002e  00 00 F9 		pop		DOSTARTH
 106 000030  00 00 F9 		pop		DOSTARTL
 107 000032  00 00 F9 		pop		DCOUNT
 108              	
 109              	; }
 110              	_endCols:
 111 000034  83 81 E8 		inc2	w3,w3				; w3-> srcM[0][c+1]
 112              	
 113              	;	restore the do loop registers
MPLAB ASM30 Listing:  ../../libVectorMatrix/mtrp.s 			page 3


 114 000036  00 00 F9 		pop		DOENDH
 115 000038  00 00 F9 		pop		DOENDL
 116 00003a  00 00 F9 		pop		DOSTARTH
 117 00003c  00 00 F9 		pop		DOSTARTL
 118 00003e  00 00 F9 		pop		DCOUNT
 119              	
 120              	; }
 121              	
 122              	;............................................................................
 123              	
 124 000040  05 00 78 		mov	w5,w0				; restore return value
 125              	
 126              	;............................................................................
 127              	
 128 000042  00 00 06 		return	
 129              	
 130              	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 131              	
 132              		.end
MPLAB ASM30 Listing:  ../../libVectorMatrix/mtrp.s 			page 4


DEFINED SYMBOLS
                            *ABS*:00000000 fake
                            *ABS*:00000001 PSV_ERRATA
                            *ABS*:00000001 __MPLAB_BUILD
                            *ABS*:00000001 __33FJ256GP710A
                            *ABS*:00000001 __dsPIC33F
                            *ABS*:00000001 __HAS_DSP
                            *ABS*:00000001 __HAS_DMA
                            *ABS*:00000001 __HAS_CODEGUARD
                            *ABS*:00000001 __C30COFF
../../libVectorMatrix/mtrp.s:64     .libdsp:00000000 _MatrixTranspose
../../libVectorMatrix/mtrp.s:110    .libdsp:00000034 _endCols
../../libVectorMatrix/mtrp.s:99     .libdsp:00000028 _endRows

UNDEFINED SYMBOLS
DCOUNT
DOSTARTL
DOSTARTH
DOENDL
DOENDH

EQUATE SYMBOLS
                      PSV_ERRATA = 0x1
                   __MPLAB_BUILD = 0x1
                 __33FJ256GP710A = 0x1
                      __dsPIC33F = 0x1
                       __HAS_DSP = 0x1
                       __HAS_DMA = 0x1
                 __HAS_CODEGUARD = 0x1
                       __C30COFF = 0x1
