MPLAB ASM30 Listing:  ../../libVectorMatrix/vsub.s 			page 1


   1              	;*********************************************************************
   2              	;                                                                    *
   3              	;                       Software License Agreement                   *
   4              	;                                                                    *
   5              	;   The software supplied herewith by Microchip Technology           *
   6              	;   Incorporated (the "Company") for its dsPIC controller            *
   7              	;   is intended and supplied to you, the Company's customer,         *
   8              	;   for use solely and exclusively on Microchip dsPIC                *
   9              	;   products. The software is owned by the Company and/or its        *
  10              	;   supplier, and is protected under applicable copyright laws. All  *
  11              	;   rights are reserved. Any use in violation of the foregoing       *
  12              	;   restrictions may subject the user to criminal sanctions under    *
  13              	;   applicable laws, as well as to civil liability for the breach of *
  14              	;   the terms and conditions of this license.                        *
  15              	;                                                                    *
  16              	;   THIS SOFTWARE IS PROVIDED IN AN "AS IS" CONDITION.  NO           *
  17              	;   WARRANTIES, WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING,    *
  18              	;   BUT NOT LIMITED TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND    *
  19              	;   FITNESS FOR A PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE     *
  20              	;   COMPANY SHALL NOT, IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL,  *
  21              	;   INCIDENTAL OR CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.  *
  22              	;                                                                    *
  23              	;   (c) Copyright 2003 Microchip Technology, All rights reserved.    *
  24              	;*********************************************************************
  25              	
  26              		; Local inclusions.
  29              		.list
  30              	
  31              	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  32              	
  33              		.section .libdsp, code
  34              	
  35              	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
  36              	;
  37              	; _VectorSubtract: Vector Subtraction.
  38              	;
  39              	; Operation:
  40              	;	dstV[n] = srcV1[n] - srcV2[n], with
  41              	;
  42              	; n in {0, 1,... , numElems-1}
  43              	;
  44              	; Input:
  45              	;	w0 = number elements in vector(s) (numElems)
  46              	;	w1 = ptr to destination vector (dstV)
  47              	;	w2 = ptr to source one vector (srcV1)
  48              	;	w3 = ptr to source two vector (srcV2)
  49              	; Return:
  50              	;	w0 = ptr to destination vector (dstV)
  51              	;
  52              	; System resources usage:
  53              	;	{w0..w4}	used, not restored
  54              	;	 AccuA		saved, used, restored
  55              	;	 AccuB		saved, used, restored
  56              	;	 CORCON		saved, used, restored
  57              	;
  58              	; DO and REPEAT instruction usage.
  59              	;	1 level DO instruction
MPLAB ASM30 Listing:  ../../libVectorMatrix/vsub.s 			page 2


  60              	;	no REPEAT intructions
  61              	;
  62              	; Program words (24-bit instructions):
  63              	;	14
  64              	;
  65              	; Cycles (including C-function call and return overheads):
  66              	;	17 + 4*numElems
  67              	;............................................................................
  68              	
  69              		.global	_VectorSubtract	; export
  70              	_VectorSubtract:
  71              	
  72              	;	save the 40 bit A accumulator
  73 000000  00 00 F8 		push	ACCAL
  74 000002  00 00 F8 		push	ACCAH
  75 000004  00 00 F8 		push	ACCAU
  76              	
  77              	;	save the 40 bit B accumulator
  78 000006  00 00 F8 		push	ACCBL
  79 000008  00 00 F8 		push	ACCBH
  80 00000a  00 00 F8 		push	ACCBU
  81              	
  82              		; Prepare CORCON for fractional computation.
  83 00000c  44 00 F8 		push	CORCON
  84              		fractsetup	w4
  84 00000e  04 0F 20 	> mov #FRACT_MODE,w4
  84 000010  24 02 88 	> mov w4,CORCON
  85              	
  86              	;............................................................................
  87              	
  88 000012  01 02 78 		mov	w1,w4				; save return value (dstV)
  89              	
  90              	;............................................................................
  91              	
  92              		; Prepare operation.
  93 000014  00 00 E9 		dec	w0,w0				; w0 = numElems-1
  94              	
  95              	;	save the do loop registers
  96 000016  00 00 F8 		push	DCOUNT
  97 000018  00 00 F8 		push	DOSTARTL
  98 00001a  00 00 F8 		push	DOSTARTH
  99 00001c  00 00 F8 		push	DOENDL
 100 00001e  00 00 F8 		push	DOENDH
 101              	
 102              		; Perform operation.
 103 000020  00 80 08 		do	w0,_endSub		; {	; do (numElems-1)+1 times
 103         00 00 00 
 104              	.ifdef PSV_ERRATA
 105 000024  B2 02 78 		mov	[w2++],w5
 106 000026  05 00 CA 		lac	w5,a			; a  = srcV1[n]
 107              							; w2-> srcV1[n+1]
 108 000028  B3 02 78 		mov	[w3++],w5
 109 00002a  05 80 CA 		lac	w5,b			; b  = srcV2[n]
 110              							; w3-> srcV2[n+1]
 111              	.else
 112              		lac	[w2++],a			; a  = srcV1[n]
 113              							; w2-> srcV1[n+1]
MPLAB ASM30 Listing:  ../../libVectorMatrix/vsub.s 			page 3


 114              		lac	[w3++],b			; b  = srcV2[n]
 115              							; w3-> srcV2[n+1]
 116              	.endif
 117 00002c  00 30 CB 		sub	a				; a -= b
 118              	_endSub:
 119 00002e  31 00 CC 		sac	a,[w1++]			; dstV[n] = srcV1[n] - srcV2[n]
 120              	
 121              	;	restore the do loop registers
 122 000030  00 00 F9 		pop		DOENDH
 123 000032  00 00 F9 		pop		DOENDL
 124 000034  00 00 F9 		pop		DOSTARTH
 125 000036  00 00 F9 		pop		DOSTARTL
 126 000038  00 00 F9 		pop		DCOUNT
 127              	
 128              	; }
 129              	
 130              	;............................................................................
 131              	
 132 00003a  04 00 78 		mov	w4,w0				; restore return value
 133              	
 134              	;............................................................................
 135              	
 136              		; restore CORCON.
 137 00003c  44 00 F9 		pop	CORCON
 138              	
 139              	;............................................................................
 140              	
 141              	;	restore the 40 bit B accumulator
 142 00003e  00 00 F9 		pop		ACCBU
 143 000040  00 00 F9 		pop		ACCBH
 144 000042  00 00 F9 		pop		ACCBL
 145              	
 146              	;	restore the 40 bit A accumulator
 147 000044  00 00 F9 		pop		ACCAU
 148 000046  00 00 F9 		pop		ACCAH
 149 000048  00 00 F9 		pop		ACCAL
 150              	
 151 00004a  00 00 06 		return	
 152              	
 153              	
 154              	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
 155              	
 156              		.end
MPLAB ASM30 Listing:  ../../libVectorMatrix/vsub.s 			page 4


DEFINED SYMBOLS
                            *ABS*:00000000 ../../libVectorMatrix/dspcommon.inc
                            *ABS*:00000000 ../../libVectorMatrix/vsub.s
                            *ABS*:00000001 PSV_ERRATA
                            *ABS*:00000001 __MPLAB_DEBUGGER_ICD3
                            *ABS*:00000001 __DEBUG
                            *ABS*:00000001 __MPLAB_DEBUG
                            *ABS*:00000001 __ICD2RAM
                            *ABS*:00000001 __MPLAB_BUILD
                            *ABS*:00000001 __33FJ256GP710A
                            *ABS*:00000001 __dsPIC33F
                            *ABS*:00000001 __HAS_DSP
                            *ABS*:00000001 __HAS_DMA
                            *ABS*:00000001 __HAS_CODEGUARD
                            *ABS*:00000001 __C30COFF
../../libVectorMatrix/dspcommon.inc:34     *ABS*:00000002 kSof
../../libVectorMatrix/dspcommon.inc:37     *ABS*:00005a82 kSinPiQ
../../libVectorMatrix/dspcommon.inc:38     *ABS*:00005a82 kInvSqrt2
../../libVectorMatrix/dspcommon.inc:44     *ABS*:00000034 PSVPAG
../../libVectorMatrix/dspcommon.inc:45     *ABS*:00000044 CORCON
../../libVectorMatrix/dspcommon.inc:46     *ABS*:00000046 MODCON
../../libVectorMatrix/dspcommon.inc:47     *ABS*:00000050 XBREV
../../libVectorMatrix/dspcommon.inc:48     *ABS*:00000048 XMODSRT
../../libVectorMatrix/dspcommon.inc:49     *ABS*:0000004a XMODEND
../../libVectorMatrix/dspcommon.inc:50     *ABS*:0000004c YMODSRT
../../libVectorMatrix/dspcommon.inc:51     *ABS*:0000004e YMODEND
../../libVectorMatrix/dspcommon.inc:56     *ABS*:00000080 SATA_ON
../../libVectorMatrix/dspcommon.inc:57     *ABS*:00000040 SATB_ON
../../libVectorMatrix/dspcommon.inc:58     *ABS*:00000020 SATDW_ON
../../libVectorMatrix/dspcommon.inc:59     *ABS*:00000010 ACCSAT_ON
../../libVectorMatrix/dspcommon.inc:60     *ABS*:000000f0 FRACT_SET
../../libVectorMatrix/dspcommon.inc:62     *ABS*:fffffffd RND_OFF
../../libVectorMatrix/dspcommon.inc:63     *ABS*:fffffffe IF_OFF
../../libVectorMatrix/dspcommon.inc:64     *ABS*:fffffffc FRACT_RESET
../../libVectorMatrix/dspcommon.inc:66     *ABS*:000000f0 FRACT_MODE
../../libVectorMatrix/dspcommon.inc:75     *ABS*:00000004 PSV_ON
../../libVectorMatrix/dspcommon.inc:96     *ABS*:0000ff00 COEFFS_IN_DATA
../../libVectorMatrix/dspcommon.inc:99     *ABS*:00000000 oNumCoeffs
../../libVectorMatrix/dspcommon.inc:100    *ABS*:00000002 oCoeffsBase
../../libVectorMatrix/dspcommon.inc:102    *ABS*:00000004 oCoeffsEnd
../../libVectorMatrix/dspcommon.inc:104    *ABS*:00000006 oCoeffsPage
../../libVectorMatrix/dspcommon.inc:106    *ABS*:00000008 oDelayBase
../../libVectorMatrix/dspcommon.inc:108    *ABS*:0000000a oDelayEnd
../../libVectorMatrix/dspcommon.inc:110    *ABS*:0000000c oDelay
../../libVectorMatrix/dspcommon.inc:116    *ABS*:00000000 oOrder
../../libVectorMatrix/dspcommon.inc:117    *ABS*:00000002 oKappaVals
../../libVectorMatrix/dspcommon.inc:118    *ABS*:00000004 oGammaVals
../../libVectorMatrix/dspcommon.inc:119    *ABS*:00000006 oLattCoeffsPage
../../libVectorMatrix/dspcommon.inc:120    *ABS*:00000008 oLattDelay
../../libVectorMatrix/vsub.s:70     .libdsp:00000000 _VectorSubtract
../../libVectorMatrix/vsub.s:118    .libdsp:0000002e _endSub

UNDEFINED SYMBOLS
ACCAL
ACCAH
ACCAU
ACCBL
MPLAB ASM30 Listing:  ../../libVectorMatrix/vsub.s 			page 5


ACCBH
ACCBU
DCOUNT
DOSTARTL
DOSTARTH
DOENDL
DOENDH

EQUATE SYMBOLS
../../libVectorMatrix/dspcommon.inc = 0x0
    ../../libVectorMatrix/vsub.s = 0x0
                      PSV_ERRATA = 0x1
           __MPLAB_DEBUGGER_ICD3 = 0x1
                         __DEBUG = 0x1
                   __MPLAB_DEBUG = 0x1
                       __ICD2RAM = 0x1
                   __MPLAB_BUILD = 0x1
                 __33FJ256GP710A = 0x1
                      __dsPIC33F = 0x1
                       __HAS_DSP = 0x1
                       __HAS_DMA = 0x1
                 __HAS_CODEGUARD = 0x1
                       __C30COFF = 0x1
                            kSof = 0x2
                         kSinPiQ = 0x5a82
                       kInvSqrt2 = 0x5a82
                          PSVPAG = 0x34
                          CORCON = 0x44
                          MODCON = 0x46
                           XBREV = 0x50
                         XMODSRT = 0x48
                         XMODEND = 0x4a
                         YMODSRT = 0x4c
                         YMODEND = 0x4e
                         SATA_ON = 0x80
                         SATB_ON = 0x40
                        SATDW_ON = 0x20
                       ACCSAT_ON = 0x10
                       FRACT_SET = 0xf0
                         RND_OFF = 0xfffffffd
                          IF_OFF = 0xfffffffe
                     FRACT_RESET = 0xfffffffc
                      FRACT_MODE = 0xf0
                          PSV_ON = 0x4
                  COEFFS_IN_DATA = 0xff00
                      oNumCoeffs = 0x0
                     oCoeffsBase = 0x2
                      oCoeffsEnd = 0x4
                     oCoeffsPage = 0x6
                      oDelayBase = 0x8
                       oDelayEnd = 0xa
                          oDelay = 0xc
                          oOrder = 0x0
                      oKappaVals = 0x2
                      oGammaVals = 0x4
                 oLattCoeffsPage = 0x6
                      oLattDelay = 0x8
